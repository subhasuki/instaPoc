{% extends 'base.html' %}
{% load static %}
{% block content %}
<style>
   
    .checkmark {
        position: absolute;
        top: 55px;
        right: -20px;
        height: 25px;
        width: 25px;
        background-color: #eee;
      }
      
</style>
<div class="content-wrapper">
    <section class="content-header">
        <div class="container-fluid" style="float: right;">
          <h3>Emergency Change</h3>
          <label for="checkboxPrimary1" style="float:right">For Update</label>
          <input type="checkbox" style="width:40px;height:20px;float:right" id="ckeckbtn">
         </div>
    </section>
  
    <section class="content"> 
      <div class="card" style="height:75%;" style="padding:15px"><br>
        <!-- <div class="card-body" style="height:80%;width:100%;">          -->
          
        <div class="col-md-12">
                <div class="row">
                  <div class="col-md-3">                                                                
                    <div class="form-group">
                    <label>Per.OP.ID:</label>     
                    <input class="form-control" type="text" name="oldidsearchnm" id="" aria-label="Search"> <br>   
                    </div>
                    </div>
                    <div class="col-12 col-md-3">                                                                
                    <div class="form-group">
                    <label>&nbsp;</label><br> 
                    <button type="submit" id="emgidsearch" class="btn btn-primary btn-sml">Search</button>
                    
                    </div>
                    </div>
                    <div class="col-md-3 dltdiv">                                                                
                    <div class="form-group">
                        <label>&nbsp;</label><br> 
                        <input type="password" class="form-control" id="dltid" name="pswck">
                    </div>
                    </div>
                    <div class="col-12 col-md-3 dltdiv">                                                                
                    <div class="form-group">
                        <label>&nbsp;</label><br>                                
                        <button type="submit" class="btn btn-warning btn-sml" id="dltid" onclick="confirmbtn()">Confirm</button>
                    </div>
                    </div>
                  </div>
        </div>
        

        <div class="row ">                            
        <div class="col-md-10">
        <div class="card card-secondary">
        <div class="card-header">
        <h3 class="card-title">Token Info:</h3>
        </div>
          <div class="card-body">
                            <div class="col-md-12">
                                <div class="row">                                          
                                <div class="col-md-4">
                                  <div class="form-group">
                                  <label>Token Number</label>
                                  <input type="hidden" class="form-control"  id="pid" name="pid">
                                  <input type="hidden" class="form-control"  id="ppid" name="ppid">
                                  <input type="text" class="form-control"  id="tokenid1" name="tokenid1" required>
                                  </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                    <label>Status</label>
                                    <select class="form-control" name="feestatus1" id="feestatusid1" onchange="tnstatuscal1()" disabled>
                                        <option value="">Select</option>
                                        <option value="Normal">Normal</option>
                                        <option value="Emergency">Emergency</option>
                                        <option value="Free">Free</option> 
                                      </select>
                                    </div>
                                  </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="cars">consultant</label> 
                                        <input list="demo4"  class="form-control" id="drtokenid1" name="drtoken1" onchange="drtokencal1()" required/>
                                        <datalist name="drtoken" id="demo4">
                                        {% for user in docname %} 
                                        <option value="{{user.drname}}">{{user.drname}}</option>
                                        {% endfor %} 
                                        </datalist>
                                  </div>
                                  </div>
                                </div>
                            </div>
                                <div class="col-md-12">
                                    <div class="row">                                          
                                    <div class="col-md-4">
                                      <div class="form-group">
                                      <label>Amount</label>
                                      <input type="text" class="form-control" id="Amount1" name="amount1" required>                                       
                                      </div>
                                    </div>
                                    <div class="col-md-4">
                                      <div class="form-group">
                                        <label>Token No</label>
                                        <input type="text" class="form-control" id="newtokenid1" name="newtokenid1" required>
                                    </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                          <label>Date</label>
                                          <input type="date" class="form-control" id="crntdt" name="crntdt">
                                      </div>
                                      </div>
                                    </div>
                                </div>
                               
                        </div>
                    </div>

                    <div class="card card-secondary">
                        <div class="card-header">
                          <h3 class="card-title">Token Info:</h3>
                        </div>                       
                        <div class="card-body">
                            <div class="col-md-12">
                                <div class="row">                                          
                                <div class="col-md-4">
                                  <div class="form-group">
                                  <label>Name</label>
                                  <input type="text" class="form-control" name="tnname1" id="tnname1" required>
                                  </div>
                                </div>
                                <div class="col-md-4">
                                  <div class="form-group">
                                    <label>Place</label>
                                    <input type="textarea" class="form-control" name="tnplace1" id="tnplace1" required>
                                </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                      <label>Gender</label>
                                      <input type="text" class="form-control" name="tgenter1" id="tgenter1" required>    
                                  </div>
                                  </div>
                                </div>
                            </div>
                                <div class="col-md-12">
                                    <div class="row">                                          
                                    <div class="col-md-4">
                                      <div class="form-group">
                                      <label>DOB</label>
                                      <input type="text" class="form-control" id="tndob1" name="tndob1">
                                      </div>
                                    </div>
                                    <div class="col-md-4">
                                      <div class="form-group">
                                        <label>Age</label>
                                        <input type="text" class="form-control" name="tnage1" id="tnage1" required>
                                    </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                          <label>MobileNO</label>
                                          <input type="text" class="form-control" name="tnmobile1" id="tnmobile1">
                                      </div>
                                      </div>
                                    </div>
                                </div>
                               
                        </div>
                    </div> 
        </div>
        <div class="col-md-2">
            <div class="row">
                <div class="col-6 col-md-12"><br><br><br>
                <div class="form-group">        
                    <button type="submit" id="updtbtn" class="btn btn-success btn-sml" disabled>Update</button>                    
                </div>
                </div>
                <div class="col-6 col-md-12"><br><br><br>
                    <div class="form-group">        
                        <button type="submit" id="dltbtn" class="btn btn-danger btn-sml">Delete</button>                    
                    </div>
                    </div>
                </div>        
        </div>
        </div>
        <!-- </div> -->
      </div> 
      </section> 
        </div>       
      
     
  {% endblock %}

  {% block javascript %}
  <script>

$(document).ready(function(){  
  $(".dltdiv").hide();

$("#dltbtn").click(function(){
  $(".dltdiv").show();
});
});

$('#ckeckbtn').click(function() {
  if ($(this).is(':checked')) {
    $('#updtbtn').removeAttr('disabled');
  } else {
    $('#updtbtn').attr('disabled', 'disabled');
  }
  if ($(this).is(':checked')) {
    $('#feestatusid1').removeAttr('disabled');
  } else {
    $('#feestatusid1').attr('disabled', 'disabled');
  }
});

$("#emgidsearch").click(function(){     
    var oldidsearchnm = $('input[name="oldidsearchnm"]').val()  //console.log(oldidsearchnm)         
    if(oldidsearchnm){
    $.ajax({
      url: '{% url "emgidsearch" %}',
      type: 'get',
      data: {
        'oldidsearchnm': oldidsearchnm,         
      },
      dataType: 'json',
      success: function(data)  { 
      if(data.oldlist){ //console.log(data.oldlist);
          var oldlistgt =  data.oldlist;//console.log(labtbl);console.log(labtbl.length);                    
          for (var i=0; i<oldlistgt.length; i++) { 
          var pid= oldlistgt[i].id;
          var name= oldlistgt[i].name;//  console.log(name)
          var age = oldlistgt[i].age;// console.log(age)
          var address = oldlistgt[i].addrs;//   console.log(address)
          var gender = oldlistgt[i].gender;//    console.log(gender)
          var dob = oldlistgt[i].dob;//        console.log(dob)                                  
          var mobileno = oldlistgt[i].mobileno;//  console.log(mobileno)
      }   
          document.getElementById("pid").value=pid;                
          document.getElementById("tnname1").value=name;  
          document.getElementById("tnage1").value=age;  
          document.getElementById("tgenter1").value=gender;  
          document.getElementById("tndob1").value=dob;  
          document.getElementById("tnmobile1").value=mobileno;
          document.getElementById("tnplace1").value=address; 
     }
          if(data.oldlistck){ //console.log(data.oldlist);
            var oldlistck =  data.oldlistck;//console.log(labtbl);console.log(labtbl.length);                    
            for (var i=0; i<oldlistck.length; i++) { 
              var ppid = oldlistck[i].id;
              var peropid = oldlistck[i].tokenno; //  console.log(peropid);
              var amount = oldlistck[i].amount; //   console.log(amount);
              }
              document.getElementById("ppid").value=ppid; 
              document.getElementById("Amount1").value=amount; 
              document.getElementById("tokenid1").value=peropid; 
           }
            }
        }); 
      }
      else
      {
        swal("Oh noes!", "Enter Per.op.id ", "error");   
      }  
      });

function drtokencal1() {     
  var drtoken1 = $('input[name="drtoken1"]').val()  //console.log(drtoken1)        
  $.ajax({
      url: '{% url "emgtokengenshot1" %}',
      type: 'get',
      data: {
            'drtoken1': drtoken1,
          },
      dataType: 'json',
      success: function(data)  {          
      if(data.h){   //    console.log(data.h);
          var shttoken =  data.h; //    console.log(shttoken);
          document.getElementById("newtokenid1").value=shttoken;        
         }
         }
    });   
  }

function tnstatuscal1(){     
  var feestatus1 = $('select[name="feestatus1"]').val()   //console.log(feestatus)       
  if (feestatus1 == "Free")
  {
    document.getElementById("Amount1").value=0;
  }
  else{
  $.ajax({
      url: '{% url "emgfeesave1" %}',
      type: 'get',
      data: {
          'feestatus1': feestatus1,
      },
      dataType: 'json',
      success: function(data)  {          
        if(data.fest1){   //    console.log(data.fest1);
          var token =  data.fest1; //console.log(token);
          document.getElementById("Amount1").value=token;
                 
        }
      }
  });
}
} 

$("#updtbtn").click(function() {  
  var ppid = $('input[name="ppid"]').val()
  var pid = $('input[name="pid"]').val()  
  var crntdt = $('input[name="crntdt"]').val()
  var oldidsearchnm = $('input[name="oldidsearchnm"]').val()// console.log(tnid)
  var drtoken1 = $('input[name="drtoken1"]').val() //console.log(drtoken)
  var tokenid1 = $('input[name="newtokenid1"]').val()  //console.log(tokenid)
  var tnname1 = $('input[name="tnname1"]').val() // console.log(tnname)
  var tgenter1 = $('input[name="tgenter1"]').val() //console.log(tgenter1) 
  var tnage1 = $('input[name="tnage1"]').val() // console.log(tnage)
  var amount1 = $('input[name="amount1"]').val()
  var feestatus1 = $('select[name="feestatus1"]').val() // console.log(feestatus)
  var tnplace1 = $('input[name="tnplace1"]').val() // console.log(tnplace)
  var tndob1 = $('input[name="tndob1"]').val() // console.log(tndob)
  var tnmobile1 = $('input[name="tnmobile1"]').val()  //console.log(tnmobile)
  var pdisease1 = $('input[name="pdisease1"]').val()  //console.log(pdisease)
  if(oldidsearchnm!='' && drtoken1!='' && tokenid1!='' && tnname1!='' 
  && tgenter1!='' && tnage1!='' && amount1!='' && feestatus1!=''
  && tnplace1!='' && tndob1!='' && pdisease1!=''){
        $.ajax({
            url: '{% url "emgpdetailssave" %}',              
            type: 'get',
            data: {
                 'pid'       :  pid,
                 'ppid'      :  ppid,
                 'crntdt'    : crntdt,
                'oldidsearchnm':  oldidsearchnm,
                'drtoken1'   :  drtoken1,                
                'tokenid1'   :  tokenid1,
                'tnname1'    :  tnname1,  
                'tgenter1'   :  tgenter1,  
                'tnage1'     :  tnage1, 
                'amount1'    :  amount1, 
                'feestatus1' :  feestatus1,  
                'tnplace1'   :  tnplace1,  
                'tndob1'     :  tndob1,    
                'tnmobile1'  :  tnmobile1, 
                'pdisease1'  :  pdisease1,                            
            },
            dataType: 'json',       
                success: function(data) {
                if(data.save){  // console.log(data.user);
                  swal("Good job!", "Save Successfully!", "success");  
                  }                                     
            }            
        });  
  }    
  else{
    swal("Oh noes!", "Please enter all fields !", "error");   
  }
});

function confirmbtn(){    
  var ppid = $('input[name="ppid"]').val()
  var pid = $('input[name="pid"]').val()  
  var pswck = $('input[name="pswck"]').val()   //console.log(feestatus)       
  if (pswck == "1TOKEN2PASS3"){   
  $.ajax({
      url: '{% url "confirmbtn" %}',
      type: 'get',
      data: {
           'pid'  :  pid,
           'ppid' :  ppid,
           'pswck': pswck,
      },
      dataType: 'json',
      success: function(data)  {          
        if(data.save){   //  console.log(data.save);         
          swal("Good job!", "Delete Successfully!", "success");        
        }
      }
  });
}
else
{
  swal("Oh noes!", "Password Incorrect", "error");   
}  
} 

</script> 

{% endblock javascript%}